<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–æ–Ω—Ç-–ë–æ—Ç 3000</title>
    <style>
        /* --- –°–¢–ò–õ–ò (CSS) --- */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            display: flex;
            justify_content: center;
            align-items: center;
            overflow: hidden;
            transition: background 1s ease;
            background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 100%); /* –°–æ–ª–Ω–µ—á–Ω—ã–π —Ñ–æ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        }

        /* –§–æ–Ω –¥–ª—è –¥–æ–∂–¥—è */
        body.rainy {
            background: linear-gradient(to bottom, #203a43, #2c5364);
        }

        .card {
            background: rgba(255, 255, 255, 0.85);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            width: 350px;
            z-index: 10;
            backdrop-filter: blur(10px);
            transition: transform 0.3s;
        }

        h1 { margin: 0 0 20px 0; color: #333; }
        
        input {
            padding: 12px;
            width: 70%;
            border-radius: 25px;
            border: 1px solid #ddd;
            font-size: 16px;
            outline: none;
        }

        button {
            padding: 12px 20px;
            border-radius: 25px;
            border: none;
            background: #ff6b6b;
            color: white;
            font-size: 16px;
            cursor: pointer;
            margin-left: 5px;
            transition: background 0.3s;
        }
        button:hover { background: #ee5253; }

        .result-box {
            margin-top: 30px;
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        }

        .temp { font-size: 48px; font-weight: bold; color: #333; }
        .city-name { font-size: 20px; color: #666; margin-bottom: 10px; }
        .message { font-size: 18px; margin-top: 10px; font-weight: bold; }
        
        /* –ò–∫–æ–Ω–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ */
        .icon { font-size: 60px; margin: 10px 0; }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –î–æ–∂–¥—è */
        .rain-drop {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.6);
            width: 2px;
            height: 15px;
            top: -20px;
            animation: fall linear infinite;
        }

        @keyframes fall {
            to { transform: translateY(105vh); }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –°–æ–ª–Ω—Ü–∞ */
        .sun-ray {
            position: absolute;
            top: -100px; right: -100px;
            width: 300px; height: 300px;
            background: radial-gradient(circle, rgba(255,255,200,0.8) 0%, rgba(255,255,255,0) 70%);
            animation: spin 20s linear infinite;
            pointer-events: none;
        }
        @keyframes spin { 
            from { transform: rotate(0deg); } to { transform: rotate(360deg); } 
        }

    </style>
</head>
<body id="mainBody">

    <!-- –°–æ–ª–Ω–µ—á–Ω—ã–π –ª—É—á -->
    <div class="sun-ray" id="sunRay"></div>
    
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞–ø–µ–ª—å –¥–æ–∂–¥—è -->
    <div id="rainContainer"></div>

    <div class="card">
        <h1>üå§Ô∏è –ë—Ä–∞—Ç—å –ª–∏ –∑–æ–Ω—Ç?</h1>
        <div>
            <input type="text" id="cityInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥..." value="Moscow">
            <button onclick="checkWeather()">üîç</button>
        </div>

        <div class="result-box" id="resultBox">
            <div class="city-name" id="cityName">–ú–æ—Å–∫–≤–∞</div>
            <div class="icon" id="weatherIcon">‚òÄÔ∏è</div>
            <div class="temp"><span id="tempVal">0</span>¬∞C</div>
            <div class="message" id="messageText">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <p style="font-size: 14px; color: #777;">–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¥–æ–∂–¥—è: <span id="probVal">0</span>%</p>
        </div>
    </div>

    <script>
        // --- –õ–û–ì–ò–ö–ê (JavaScript) ---
        
        async function checkWeather() {
            const city = document.getElementById('cityInput').value;
            const btn = document.querySelector('button');
            const resultBox = document.getElementById('resultBox');
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
            btn.textContent = "‚è≥";
            btn.disabled = true;

            try {
                // –ó–∞–ø—Ä–æ—Å –∫ –Ω–∞—à–µ–º—É Flask —Å–µ—Ä–≤–µ—Ä—É
                const response = await fetch(`/predict?city=${city}`);
                const data = await response.json();

                if (data.error) {
                    alert(data.error);
                    return;
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                document.getElementById('cityName').textContent = data.city;
                document.getElementById('tempVal').textContent = data.temp;
                document.getElementById('probVal').textContent = data.prob;
                
                resultBox.style.display = 'block';

                // –ú–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–î–æ–∂–¥—å vs –°–æ–ª–Ω—Ü–µ)
                setWeatherState(data.rain_predicted, data.desc);

            } catch (error) {
                alert("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º");
            } finally {
                btn.textContent = "üîç";
                btn.disabled = false;
            }
        }

        function setWeatherState(isRaining, desc) {
            const body = document.getElementById('mainBody');
            const rainContainer = document.getElementById('rainContainer');
            const sunRay = document.getElementById('sunRay');
            const icon = document.getElementById('weatherIcon');
            const msg = document.getElementById('messageText');

            msg.textContent = desc;

            if (isRaining) {
                // –†–ï–ñ–ò–ú –î–û–ñ–î–Ø
                body.classList.add('rainy');
                sunRay.style.display = 'none';
                icon.textContent = '‚òî';
                msg.style.color = '#4a69bd';
                createRain(); // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∫–∞–ø–µ–ª—å
            } else {
                // –†–ï–ñ–ò–ú –°–û–õ–ù–¶–ê
                body.classList.remove('rainy');
                sunRay.style.display = 'block';
                icon.textContent = '‚òÄÔ∏è';
                msg.style.color = '#e58e26';
                clearRain(); // –£–±–∏—Ä–∞–µ–º –∫–∞–ø–ª–∏
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞–ø–µ–ª—å –¥–æ–∂–¥—è
        let rainInterval;
        function createRain() {
            clearRain();
            const container = document.getElementById('rainContainer');
            
            rainInterval = setInterval(() => {
                const drop = document.createElement('div');
                drop.classList.add('rain-drop');
                drop.style.left = Math.random() * 100 + "vw"; // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
                drop.style.animationDuration = Math.random() * 0.5 + 0.5 + "s"; // –°–ª—É—á–∞–π–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
                drop.style.opacity = Math.random();
                
                container.appendChild(drop);

                // –£–¥–∞–ª—è–µ–º –∫–∞–ø–ª—é, –∫–æ–≥–¥–∞ –æ–Ω–∞ —É–ø–∞–ª–∞, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å –ø–∞–º—è—Ç—å
                setTimeout(() => {
                    drop.remove();
                }, 1000);
            }, 50); // –ß–∞—Å—Ç–æ—Ç–∞ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞–ø–µ–ª—å
        }

        function clearRain() {
            clearInterval(rainInterval);
            document.getElementById('rainContainer').innerHTML = '';
        }
    </script>
</body>
</html>